<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏–π –£–ø—Ä–æ—Å—Ç–∏—Ç–µ–ª—å - –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ò–≥—Ä–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1000px;
            width: 100%;
            padding: 30px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .expression-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            min-height: 200px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            justify-content: center;
            border: 3px solid #e0e0e0;
        }

        .term {
            background: white;
            border: 3px solid #667eea;
            border-radius: 10px;
            padding: 15px 25px;
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .term:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .term.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.1);
            border-color: #764ba2;
        }

        .term.correct {
            animation: correctPulse 0.6s;
        }

        .term.wrong {
            animation: wrongShake 0.5s;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); background: #4CAF50; }
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .operator {
            font-size: 1.8em;
            color: #667eea;
            font-weight: bold;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        }

        .message {
            text-align: center;
            font-size: 1.3em;
            color: #667eea;
            font-weight: bold;
            min-height: 40px;
            margin-bottom: 20px;
        }

        .hint-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
        }

        .hint-box strong {
            color: #664d03;
        }

        .victory-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .victory-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 500px;
            animation: victoryPop 0.5s;
        }

        @keyframes victoryPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .victory-content h2 {
            color: #4CAF50;
            font-size: 3em;
            margin-bottom: 20px;
        }

        .victory-content p {
            font-size: 1.3em;
            color: #666;
            margin-bottom: 30px;
        }

        .difficulty-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .difficulty-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .difficulty-btn:hover {
            background: #667eea;
            color: white;
        }

        .difficulty-btn.active {
            background: #667eea;
            color: white;
        }

        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            height: 20px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4CAF50 0%, #45a049 100%);
            height: 100%;
            transition: width 0.3s;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>üßÆ –ê–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏–π –£–ø—Ä–æ—Å—Ç–∏—Ç–µ–ª—å</h1>
            <p>–ö–ª–∏–∫–∞–π –Ω–∞ –ø–æ–¥–æ–±–Ω—ã–µ —Å–ª–∞–≥–∞–µ–º—ã–µ, —á—Ç–æ–±—ã —É–ø—Ä–æ—Å—Ç–∏—Ç—å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ!</p>
        </div>

        <div class="stats">
            <div class="stat-box">
                <div class="stat-label">üìä –£—Ä–æ–≤–µ–Ω—å</div>
                <div class="stat-value" id="level">1</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">‚≠ê –û—á–∫–∏</div>
                <div class="stat-value" id="score">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">üéØ –°–ª–∞–≥–∞–µ–º—ã—Ö</div>
                <div class="stat-value" id="termsLeft">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">üî• –ö–æ–º–±–æ</div>
                <div class="stat-value" id="combo">0</div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressBar" style="width: 0%"></div>
        </div>

        <div class="message" id="message">–í—ã–±–µ—Ä–∏ –¥–≤–∞ –ø–æ–¥–æ–±–Ω—ã—Ö —Å–ª–∞–≥–∞–µ–º—ã—Ö!</div>

        <div class="hint-box">
            <strong>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> –ü–æ–¥–æ–±–Ω—ã–µ —Å–ª–∞–≥–∞–µ–º—ã–µ –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –±—É–∫–≤–µ–Ω–Ω—É—é —á–∞—Å—Ç—å. 
            –ù–∞–ø—Ä–∏–º–µ—Ä: <code>3x</code> –∏ <code>5x</code>, –∏–ª–∏ <code>2xy</code> –∏ <code>-4xy</code>
        </div>

        <div class="expression-container" id="expressionContainer"></div>

        <div class="controls">
            <button class="btn" onclick="newExpression()">üîÑ –ù–æ–≤–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ</button>
            <button class="btn btn-secondary" onclick="clearSelection()">‚ùå –°–±—Ä–æ—Å–∏—Ç—å –≤—ã–±–æ—Ä</button>
            <button class="btn btn-success" onclick="checkSolution()">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–ø—Ä–æ—â–µ–Ω–∏–µ</button>
        </div>

        <div class="difficulty-selector">
            <button class="difficulty-btn active" onclick="setDifficulty('easy')">–õ–µ–≥–∫–æ</button>
            <button class="difficulty-btn" onclick="setDifficulty('medium')">–°—Ä–µ–¥–Ω–µ</button>
            <button class="difficulty-btn" onclick="setDifficulty('hard')">–°–ª–æ–∂–Ω–æ</button>
        </div>
    </div>

    <div class="victory-screen" id="victoryScreen">
        <div class="victory-content">
            <h2>üéâ –ü–û–ë–ï–î–ê!</h2>
            <p id="victoryMessage">–í—ã—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–ø—Ä–æ—â–µ–Ω–æ!</p>
            <div id="victoryStats"></div>
            <button class="btn" onclick="nextLevel()">–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å ‚û°Ô∏è</button>
        </div>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        let gameState = {
            level: 1,
            score: 0,
            combo: 0,
            difficulty: 'easy',
            terms: [],
            selectedTerms: [],
            totalTermsInExpression: 0
        };

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        const variables = ['x', 'y', 'z', 'a', 'b'];
        const multiVars = ['xy', 'xz', 'yz', 'ab', 'x¬≤', 'y¬≤'];

        // –ö–ª–∞—Å—Å –¥–ª—è —Å–ª–∞–≥–∞–µ–º–æ–≥–æ
        class Term {
            constructor(coefficient, variable) {
                this.coefficient = coefficient;
                this.variable = variable;
                this.id = Math.random().toString(36).substr(2, 9);
            }

            toString() {
                if (this.coefficient === 0) return '0';
                
                let result = '';
                
                if (this.variable === '') {
                    result = this.coefficient.toString();
                } else {
                    if (this.coefficient === 1) {
                        result = this.variable;
                    } else if (this.coefficient === -1) {
                        result = '-' + this.variable;
                    } else {
                        result = this.coefficient + this.variable;
                    }
                }
                
                return result;
            }

            isSimilar(other) {
                return this.variable === other.variable;
            }

            add(other) {
                if (!this.isSimilar(other)) return null;
                return new Term(this.coefficient + other.coefficient, this.variable);
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞
        function randomCoeff(difficulty) {
            let max;
            switch(difficulty) {
                case 'easy': max = 10; break;
                case 'medium': max = 20; break;
                case 'hard': max = 50; break;
                default: max = 10;
            }
            
            let coeff = Math.floor(Math.random() * max) + 1;
            return Math.random() > 0.5 ? coeff : -coeff;
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—ã—Ä–∞–∂–µ–Ω–∏—è
        function generateExpression(level, difficulty) {
            const terms = [];
            let numTerms;
            let numVariables;

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–∞–≥–∞–µ–º—ã—Ö –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
            switch(difficulty) {
                case 'easy':
                    numTerms = 4 + Math.floor(level / 2);
                    numVariables = Math.min(2, 1 + Math.floor(level / 3));
                    break;
                case 'medium':
                    numTerms = 6 + Math.floor(level / 2);
                    numVariables = Math.min(3, 2 + Math.floor(level / 3));
                    break;
                case 'hard':
                    numTerms = 8 + Math.floor(level / 2);
                    numVariables = Math.min(4, 2 + Math.floor(level / 2));
                    break;
            }

            numTerms = Math.min(numTerms, 20); // –ú–∞–∫—Å–∏–º—É–º 20 —Å–ª–∞–≥–∞–µ–º—ã—Ö

            // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è
            const usedVars = [];
            const varPool = difficulty === 'hard' && level > 5 ? [...variables, ...multiVars] : variables;
            
            for (let i = 0; i < numVariables; i++) {
                const randomVar = varPool[Math.floor(Math.random() * varPool.length)];
                if (!usedVars.includes(randomVar)) {
                    usedVars.push(randomVar);
                }
            }

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª–∞–≥–∞–µ–º—ã–µ —Ç–∞–∫, —á—Ç–æ–±—ã –±—ã–ª–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥–æ–±–Ω—ã—Ö
            for (let i = 0; i < numTerms; i++) {
                const variable = usedVars[Math.floor(Math.random() * usedVars.length)];
                const coefficient = randomCoeff(difficulty);
                terms.push(new Term(coefficient, variable));
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –¥–ª—è —É—Å–ª–æ–∂–Ω–µ–Ω–∏—è
            if (difficulty !== 'easy' && Math.random() > 0.5) {
                const numConstants = Math.floor(Math.random() * 3) + 1;
                for (let i = 0; i < numConstants; i++) {
                    terms.push(new Term(randomCoeff(difficulty), ''));
                }
            }

            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º
            for (let i = terms.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [terms[i], terms[j]] = [terms[j], terms[i]];
            }

            return terms;
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
        function renderExpression() {
            const container = document.getElementById('expressionContainer');
            container.innerHTML = '';

            gameState.terms.forEach((term, index) => {
                // –°–æ–∑–¥–∞—ë–º —ç–ª–µ–º–µ–Ω—Ç —Å–ª–∞–≥–∞–µ–º–æ–≥–æ
                const termEl = document.createElement('div');
                termEl.className = 'term';
                termEl.textContent = term.toString();
                termEl.dataset.id = term.id;
                termEl.addEventListener('click', () => selectTerm(term.id));
                container.appendChild(termEl);

                // –î–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞–∫ +, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–ª–∞–≥–∞–µ–º–æ–µ
                if (index < gameState.terms.length - 1) {
                    const operator = document.createElement('span');
                    operator.className = 'operator';
                    
                    // –ï—Å–ª–∏ —Å–ª–µ–¥—É—é—â–µ–µ —Å–ª–∞–≥–∞–µ–º–æ–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∏–Ω—É—Å
                    const nextTerm = gameState.terms[index + 1];
                    if (nextTerm.coefficient < 0) {
                        operator.textContent = '‚àí';
                        // –î–µ–ª–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                        nextTerm.coefficient = Math.abs(nextTerm.coefficient);
                    } else {
                        operator.textContent = '+';
                    }
                    
                    container.appendChild(operator);
                }
            });

            updateStats();
        }

        // –í—ã–±–æ—Ä —Å–ª–∞–≥–∞–µ–º–æ–≥–æ
        function selectTerm(termId) {
            const term = gameState.terms.find(t => t.id === termId);
            if (!term) return;

            const termEl = document.querySelector(`[data-id="${termId}"]`);
            
            // –ï—Å–ª–∏ —Å–ª–∞–≥–∞–µ–º–æ–µ —É–∂–µ –≤—ã–±—Ä–∞–Ω–æ, –æ—Ç–º–µ–Ω—è–µ–º –≤—ã–±–æ—Ä
            if (gameState.selectedTerms.includes(termId)) {
                gameState.selectedTerms = gameState.selectedTerms.filter(id => id !== termId);
                termEl.classList.remove('selected');
                return;
            }

            // –ï—Å–ª–∏ —É–∂–µ –≤—ã–±—Ä–∞–Ω–æ 2 —Å–ª–∞–≥–∞–µ–º—ã—Ö, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º
            if (gameState.selectedTerms.length >= 2) {
                clearSelection();
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
            gameState.selectedTerms.push(termId);
            termEl.classList.add('selected');

            // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ 2 —Å–ª–∞–≥–∞–µ–º—ã—Ö, –ø—Ä–æ–≤–µ—Ä—è–µ–º
            if (gameState.selectedTerms.length === 2) {
                setTimeout(() => checkCombination(), 300);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
        function checkCombination() {
            const term1 = gameState.terms.find(t => t.id === gameState.selectedTerms[0]);
            const term2 = gameState.terms.find(t => t.id === gameState.selectedTerms[1]);

            if (!term1 || !term2) return;

            const term1El = document.querySelector(`[data-id="${term1.id}"]`);
            const term2El = document.querySelector(`[data-id="${term2.id}"]`);

            if (term1.isSimilar(term2)) {
                // –ü—Ä–∞–≤–∏–ª—å–Ω–æ!
                term1El.classList.add('correct');
                term2El.classList.add('correct');

                const combined = term1.add(term2);
                
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–º–±–æ –∏ –æ—á–∫–∏
                gameState.combo++;
                gameState.score += 10 * gameState.combo;

                showMessage(`‚úÖ –û—Ç–ª–∏—á–Ω–æ! ${term1.toString()} + (${term2.toString()}) = ${combined.toString()}`, 'success');

                setTimeout(() => {
                    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–ª–∞–≥–∞–µ–º—ã–µ
                    gameState.terms = gameState.terms.filter(t => 
                        t.id !== term1.id && t.id !== term2.id
                    );

                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–æ–µ —Å–ª–∞–≥–∞–µ–º–æ–µ, –µ—Å–ª–∏ –æ–Ω–æ –Ω–µ —Ä–∞–≤–Ω–æ 0
                    if (combined.coefficient !== 0) {
                        gameState.terms.push(combined);
                    }

                    gameState.selectedTerms = [];
                    renderExpression();

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–µ–¥—É
                    if (isSimplified()) {
                        showVictory();
                    }
                }, 1000);

            } else {
                // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
                term1El.classList.add('wrong');
                term2El.classList.add('wrong');
                gameState.combo = 0;

                showMessage(`‚ùå –≠—Ç–∏ —Å–ª–∞–≥–∞–µ–º—ã–µ –Ω–µ –ø–æ–¥–æ–±–Ω—ã! ${term1.variable || '–∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞'} ‚â† ${term2.variable || '–∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞'}`, 'error');

                setTimeout(() => {
                    term1El.classList.remove('wrong');
                    term2El.classList.remove('wrong');
                    clearSelection();
                }, 500);
            }
        }

        // –°–±—Ä–æ—Å –≤—ã–±–æ—Ä–∞
        function clearSelection() {
            gameState.selectedTerms.forEach(id => {
                const el = document.querySelector(`[data-id="${id}"]`);
                if (el) el.classList.remove('selected');
            });
            gameState.selectedTerms = [];
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —É–ø—Ä–æ—â–µ–Ω–æ –ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
        function isSimplified() {
            const variables = {};
            
            for (const term of gameState.terms) {
                if (variables[term.variable]) {
                    return false; // –ï—Å—Ç—å –ø–æ–¥–æ–±–Ω—ã–µ —Å–ª–∞–≥–∞–µ–º—ã–µ
                }
                variables[term.variable] = true;
            }
            
            return true;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—à–µ–Ω–∏—è
        function checkSolution() {
            if (isSimplified()) {
                showVictory();
            } else {
                showMessage('‚ùå –í—ã—Ä–∞–∂–µ–Ω–∏–µ –µ—â—ë –º–æ–∂–Ω–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å! –ò—â–∏ –ø–æ–¥–æ–±–Ω—ã–µ —Å–ª–∞–≥–∞–µ–º—ã–µ.', 'error');
                gameState.combo = 0;
                updateStats();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.style.color = type === 'error' ? '#f5576c' : '#4CAF50';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –ø–æ–±–µ–¥—ã
        function showVictory() {
            const victoryScreen = document.getElementById('victoryScreen');
            const victoryMessage = document.getElementById('victoryMessage');
            const victoryStats = document.getElementById('victoryStats');

            const simplificationPercent = Math.round((1 - gameState.terms.length / gameState.totalTermsInExpression) * 100);
            
            victoryMessage.textContent = `–í—ã—Ä–∞–∂–µ–Ω–∏–µ —É–ø—Ä–æ—â–µ–Ω–æ –Ω–∞ ${simplificationPercent}%!`;
            victoryStats.innerHTML = `
                <p><strong>–û—á–∫–∏:</strong> ${gameState.score}</p>
                <p><strong>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–º–±–æ:</strong> ${gameState.combo}</p>
                <p><strong>–°–ª–∞–≥–∞–µ–º—ã—Ö –æ—Å—Ç–∞–ª–æ—Å—å:</strong> ${gameState.terms.length}</p>
            `;

            victoryScreen.style.display = 'flex';
        }

        // –°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å
        function nextLevel() {
            gameState.level++;
            gameState.combo = 0;
            document.getElementById('victoryScreen').style.display = 'none';
            newExpression();
        }

        // –ù–æ–≤–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
        function newExpression() {
            gameState.terms = generateExpression(gameState.level, gameState.difficulty);
            gameState.totalTermsInExpression = gameState.terms.length;
            gameState.selectedTerms = [];
            gameState.combo = 0;
            renderExpression();
            showMessage('–í—ã–±–µ—Ä–∏ –¥–≤–∞ –ø–æ–¥–æ–±–Ω—ã—Ö —Å–ª–∞–≥–∞–µ–º—ã—Ö!', 'info');
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        function setDifficulty(difficulty) {
            gameState.difficulty = difficulty;
            gameState.level = 1;
            gameState.score = 0;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            newExpression();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('termsLeft').textContent = gameState.terms.length;
            document.getElementById('combo').textContent = gameState.combo;

            // –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
            const progress = Math.max(0, 100 - (gameState.terms.length / gameState.totalTermsInExpression * 100));
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function init() {
            newExpression();
            showMessage('üéØ –ù–∞—á–Ω–∏ —É–ø—Ä–æ—â–∞—Ç—å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ! –ö–ª–∏–∫–∞–π –Ω–∞ –ø–æ–¥–æ–±–Ω—ã–µ —Å–ª–∞–≥–∞–µ–º—ã–µ.', 'info');
        }

        init();
    </script>
</body>
</html>